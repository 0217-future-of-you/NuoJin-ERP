<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="../JS/jquery-1.8.3.min.js"></script>
    <script src="../JS/jquery-2.1.0.min.js"></script>
    <script src="../JS/jquery.js"></script>
    <script src="../JS/jquery.min.js"></script>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="../My97DatePicker/My97DatePicker/WdatePicker.js"></script>
    <script src="../My97DatePicker/My97DatePicker/calendar.js"></script>
    <script src="../JS/funtion.js"></script>
    <title>人事部门需要</title>
    <style>
        /* 最大的父级 */

        .wrap {
            width: 100%;
            margin: 0 auto;
        }

        .btns button {
            display: block;
            margin: 20px 0;
            width: 100%;
            font-size: 20px;
            font-family: 'STkaiti';
        }

        table {
            margin-top: 30px;
        }

            table th,
            table td {
                text-align: center;
                white-space: nowrap;
            }

        .contents,
        .container-fluid {
            padding: 20px;
        }

        .modal-body input,
        textarea {
            width: 250px;
            border: 1px solid #999999;
            font-size: 20px;
            border-radius: 10px;
            outline: none;
            margin: 5px 0;
        }

        textarea {
            height: 33px;
            resize: vertical;
            overflow-y: hidden;
        }

  

        .modal-content {
            margin: 0 auto;
            text-align: center;
            width: 400px;
        }

        .sexBox .sexOption {
            text-align: center;
            width: 50px;
            border: 1px solid #e5e5e5;
        }

        .Skill,
        textarea {
            vertical-align: middle;
            display: inline-block;
        }

        .Age > .requirementAge {
            width: 119px;
        }
        /* 下拉框 */

        #select,
        #amendSelect {
            width: 248px;
            padding: 7px;
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12 contents">
                        <div>
                            <!-- 添加按钮 -->
                            <button type="button" class="btn btn-primary Bneed" data-toggle="modal" data-target="#myModal">
                                部门人员需求
                            </button>
                            <!-- 表格 -->
                            <div class="needList">
                                <div id="page"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 添加部门需求 -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title" id="myModalLabel">部门需求人员</h4>
                    </div>
                    <div class="modal-body">
                        <div>
                            <span> 岗位:</span>
                            <input type="text" class="requirementName">
                        </div>
                        <div class="Age">
                            <span>年龄:</span><input type="number" class="requirementMin requirementAge">
                            <span class="section">~</span>
                            <input type="number" class="requirementMax requirementAge">
                        </div>
                        <div class="sexBox">
                            <span class="sexTitle">性别:</span>
                            <select name="Sex" id="select" onfocus="this.blur()">
                                <option value="男">男</option>
                                <option value="女">女</option>
                                <option value="男女不限">男女不限</option>
                            </select>
                        </div>
                        <div>
                            <span>人数:</span>
                            <input type="text" class="requirementNumber">
                        </div>
                        <div><span>学历:</span><input type="text" class="requirementeDucation"></div>
                        <div>
                            <span>需招:</span>
                            <input type="text" class="needNumber">
                        </div>
                        <div>
                            <span>已招:</span>
                            <input type="text" class="possess">
                        </div>
                        <div class="Skill">
                            <span>技能:</span>
                            <textarea class="requirementSkill" name="" id="" cols="30" rows="10"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary" id="saveAdd" data-dismiss="modal" data-dismiss="modal" data-toggle="modal" data-target=".bs-example-modal-sm" onclick="saveAdd()">确认添加</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- 修改部门需求 -->
        <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title" id="myModalLabel">修改信息</h4>
                    </div>
                    <div class="modal-body">
                        <input type='hidden' id="xNew">
                        <div>
                            <span> 岗位:</span>
                            <input type="text" id="amendName">
                        </div>
                        <div class="Age">
                            <span>年龄:</span><input type="number" id="amendMin" class="requirementAge">
                            <span class="section">~</span>
                            <input type="number" class="requirementAge" id="amendMax">
                        </div>
                        <div class="sexBox">
                            <span class="sexTitle">性别:</span>
                            <select name="Sex" id="amendSelect" onfocus="this.blur()">
                                <option value="男">男</option>
                                <option value="女">女</option>
                                <option value="男女不限">男女不限</option>
                            </select>
                        </div>
                        <div>
                            <span>人数:</span>
                            <input type="text" id="amendNumber">
                        </div>
                        <div><span>学历:</span><input type="text" id="amendDucation"></div>
                        <div>
                            <span>需招</span>
                            <input type="text" id="needNumbers">
                        </div>
                        <div>
                            <span>已招</span>
                            <input type="text" id="amendPossess">
                        </div>
                        <div class="Skill">
                            <span>技能:</span>
                            <textarea id="amendSkill" name="" id="" cols="30" rows="10"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary" id="saveAdd" data-dismiss="modal" data-dismiss="modal" data-toggle="modal" data-target=".bs-example-modal-sm" onclick="modification()">确认修改</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
<script>
    window.onload = needFn();
    // 显示需求数据
    function needFn(page) {
        if (page == null) {
            page = 1;
        }
        $.ajax({
            type: "POST",
            url: 'http://318jp82710.eicp.vip/api/PersonnelRts/GetList',
            headers: {
                Authorization: "Bearer " + window.localStorage.getItem("token"),
                UserId: window.localStorage.getItem("UserId"),
                AppFlag: window.localStorage.getItem("AppFlag")
            },
            data: {
                PageIndex: page,
                PageSize: 10
            },
            success: function (res) {
                var data = res;
                var tableStr = "<table class='table table-hover'>";
                tableStr = tableStr + "<th>岗位</th><th>年龄</th><th>性别</th><th>人数</th><th>学历</th><th>技能</th><th>需招</th><th>已招</th><th>招收情况</th><th>操作</th></tr>";
                var len = data[0].Count;
                for (var i = 0; i < data.length; i++) {
                    tableStr = tableStr + " <tr><td>" + data[i].Position + "</td><td>" + data[i].Age + "</td><td>" + data[i].Sex + "</td><td>" + data[i].RecruitedNumber + "</td><td>" + data[i].Education + "</td><td>" + data[i].SkillRequirements + "</td><td>" + data[i].Number + "</td><td>" + data[i].RecruitedNumber + "</td><td id='status'>" + recruit(data[i].Number, data[i].RecruitedNumber) + "</td><td><button type='button' data-toggle='modal' data-target='.bs-example-modal-lg' onclick='amend(" + i + ")'>更新</button></td><td><input type='hidden'value='" + data[i].PersonnelRtsId + "' id='text" + i + "' /></td></tr> ";
                }
                tableStr = tableStr + "</tbody></table>";
                //将动态生成的table添加的事先隐藏的div中.
                $(".needList").html(tableStr);
                var index = len / 10;
                index = Math.round(index);
                var str = "<p>";
                for (var i = 1; i < index + 1; i++) {
                    str += "  <button type='button' onclick='needFn(" + i + ")'>" + i + "</button>";
                }
                str += "</p>";
                $("#page").html(str);
            }
        })
    }
    // 添加部门人员需求
    function saveAdd() {
        // 获取输入框中的值
        var requirementName = $(".requirementName").val();
        // 最小年龄
        var requirementMin = $(".requirementMin").val();
        // 最大年龄
        var requirementMax = $(".requirementMax").val();
        var requirementSex = $("#select").val();
        var requirementNumber = $(".requirementNumber").val();
        var requirementeDucation = $(".requirementeDucation").val();
        var needNumber = $(".needNumber").val();
        var possess = $(".possess").val();
        var requirementSkill = $(".requirementSkill").val();
        if (requirementName == "" || requirementMin == "" || requirementMax == "" || requirementSex == "" || requirementNumber == "" || requirementeDucation == "" || needNumber == "" || possess == "" || requirementSkill == "") {
            alert("请填写完整！")
        } else {
            // 发送请求
            $.ajax({
                type: "POST",
                url: "http://318jp82710.eicp.vip/api/PersonnelRts/Add",
                headers: {
                    Authorization: "Bearer " + window.localStorage.getItem("token"),
                    UserId: window.localStorage.getItem("UserId"),
                    AppFlag: window.localStorage.getItem("AppFlag")
                },
                data: {
                    Position: requirementName,
                    // 发送数据
                    Age: requirementMin + '~' + requirementMax,
                    Sex: requirementSex,
                    RecruitedNumber: requirementNumber,
                    Education: requirementeDucation,
                    Number: needNumber,
                    RecruitedNumber: possess,
                    SkillRequirements: requirementSkill
                },
                success: function (res) {
                    uptable(res)
                }
            })
        }

    }
    // 调用数据
    function amend(xx) {
        var amend = $("#text" + xx + "").val();
        $.ajax({
            type: "POST",
            url: 'http://318jp82710.eicp.vip/api/PersonnelRts/GetList',
            headers: {
                Authorization: "Bearer " + window.localStorage.getItem("token"),
                UserId: window.localStorage.getItem("UserId"),
                AppFlag: window.localStorage.getItem("AppFlag")
            },
            data: {
                PersonnelRtsId: amend,
            },
            success: function (res) {
                var data = res;
                document.getElementById("amendName").value = data[0].Position;
                document.getElementById("amendSelect").text = data[0].Sex;
                console.log(document.getElementById("amendSelect").text);
                var res = data[0].Age.indexOf("~");
                var res1 = data[0].Age.substr(0, res);
                var res2 = data[0].Age.substr(res + 1, data.Length);
                document.getElementById("amendMin").value = res1;
                document.getElementById("amendMax").value = res2;
                document.getElementById("amendNumber").value = data[0].RecruitedNumber;
                document.getElementById("amendDucation").value = data[0].Education;
                document.getElementById("needNumbers").value = data[0].Number;
                document.getElementById("amendPossess").value = data[0].RecruitedNumber;
                document.getElementById("amendSkill").value = data[0].SkillRequirements;
                document.getElementById("xNew").value = data[0].PersonnelRtsId;
            }
        })
    }
    // 更新数据
    function modification() {
        // 获取输入框中的值
        var xNew = $("#xNew").val();
        var amendName = $("#amendName").val();
        // 最小年龄
        var amendMin = $("#amendMin").val();
        // 最大年龄
        var amendMax = $("#amendMax").val();
        var amendSelect = $("#amendSelect").val();
        console.log(amendSelect)
        var amendNumber = $("#amendNumber").val();
        var amendDucation = $("#amendDucation").val();
        var needNumbers = $("#needNumbers").val();
        var amendPossess = $("#amendPossess").val();
        var amendSkill = $("#amendSkill").val();
        // 发送请求
        $.ajax({
            type: "POST",
            url: "http://318jp82710.eicp.vip/api/PersonnelRts/Update",
            headers: {
                Authorization: "Bearer " + window.localStorage.getItem("token"),
                UserId: window.localStorage.getItem("UserId"),
                AppFlag: window.localStorage.getItem("AppFlag")
            },
            data: {
                PersonnelRtsId: xNew,
                Position: amendName,
                Age: amendMin + '~' + amendMax,
                Sex: amendSelect,
                RecruitedNumber: amendNumber,
                Education: amendDucation,
                Number: needNumbers,
                RecruitedNumber: amendPossess,
                SkillRequirements: amendSkill
            },
            success: function (res) {
                uptable(res)
            }
        })
    }
    // 判断招收情况
    function recruit(x, y) {
        if (x > y) {
            console.log(1);
            return ("未招满")
        } else if (x == y) {
            return ("已招满")
        } else {
            return ("超出")
        }
    }
</script>